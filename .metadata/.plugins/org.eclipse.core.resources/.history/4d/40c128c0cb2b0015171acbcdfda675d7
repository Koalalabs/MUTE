package view;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Image;
import java.awt.Insets;
import java.awt.MouseInfo;
import java.awt.Rectangle;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.awt.geom.Ellipse2D;
import java.awt.geom.Rectangle2D;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.net.URISyntaxException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.List;

import javax.imageio.ImageIO;
import javax.imageio.ImageReader;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JMenuItem;
import javax.swing.JPanel;

public class FussballDialog extends JFrame {
	private static final long serialVersionUID = -4433303476030918900L;
	private JPanel pSpielfeld;
	private JMenuBar menuBar;
	private JMenuItem mntmSpielerErstellen;
	private JMenu mnSpieler;
	private JMenuItem mntmSpielerSuchen;
	private Image bank;
	public ErsatzbankInfoDialog ersatzbankDialog;
	public List<ShapeUndSpieler> ersatzbankPositionen;
	public List<ShapeUndSpieler> spielfeldPositionen;
	private boolean drag = false;
	public Spieler gewaehlterSpieler;
	private ShapeUndSpieler ausgewaehltePosition;
	private JMenu mnVerein;
	private JMenuItem mntmVereinErstellen;
	public ShapeUndVerein ausgewaehlterVerein;
	private JMenuItem mntmVereinAuswaehlen;
	private VereinInfoDialog vereinInfoDialog;
	private JMenuItem mntmSpielerAusVerein;
	private boolean formationErstellenModus = false;
	private JPanel pButtons;
	private JComboBox<Formation> cBFormationen;
	private JButton btnUebernehmen;
	private JButton btnFormationAendern;
	private JLabel lblFormation;
	private JButton btnAbbrechen;
	private JMenu mnFormation;
	private JMenuItem mntmFormationSuchen;
	private String ausgewaehltesBild;
	private JButton btnNeuStarten;

	public List<ShapeUndSpieler> getErsatzbankPositionen() {
		if (ersatzbankPositionen == null) {
			ersatzbankPositionen = new ArrayList<>();
			for (int i = 25; i < 926; i += 75) {
				ersatzbankPositionen.add(new ShapeUndSpieler(
						erzeugeRectangle(i), null));
			}
		}
		return ersatzbankPositionen;
	}

	public FussballDialog() {
		setAusgewaehlterVerein(new ShapeUndVerein(
				new Rectangle(0, 0, 100, 100), new VereinDAO().findByKey(1)));
		this.setResizable(false);
		initGUI();
	}

	private void initGUI() {
		getContentPane().add(getMyMenuBar(), BorderLayout.NORTH);
		getContentPane().add(getPSpielfeld(), BorderLayout.CENTER);
		this.addWindowListener(new WindowAdapter() {
			@Override
			public void windowClosing(WindowEvent e) {
				System.exit(0);
			}
		});
		pack();
		getContentPane().add(getPButtons(), BorderLayout.NORTH);
	}

	public JPanel getPSpielfeld() {
		if (pSpielfeld == null) {
			pSpielfeld = new JPanel();
			pSpielfeld.setBackground(Color.BLACK);
			try {
				BufferedImage image = ImageIO.read(new File(
						"C:\\Users\\Jacobsen_Thies\\Pictures\\Spielfeld2.jpg"));
				JLabel spielfeldLabel = new Spielfeld(image);
				spielfeldLabel.setPreferredSize(new Dimension(800, 1080));
				spielfeldLabel.setMinimumSize(new Dimension(800, 1080));
				spielfeldLabel.setMaximumSize(new Dimension(800, 1080));
				pSpielfeld.add(spielfeldLabel);
				GridBagLayout gbl_pSpielfeld = new GridBagLayout();
				gbl_pSpielfeld.columnWidths = new int[] { 0, 0 };
				gbl_pSpielfeld.rowHeights = new int[] { 0, 0, 0, 0 };
				gbl_pSpielfeld.columnWeights = new double[] { 1.0,
						Double.MIN_VALUE };
				gbl_pSpielfeld.rowWeights = new double[] { 0.0, 0.0, 0.0,
						Double.MIN_VALUE };
				pSpielfeld.setLayout(gbl_pSpielfeld);
				GridBagConstraints gbc_textField = new GridBagConstraints();
				gbc_textField.fill = GridBagConstraints.HORIZONTAL;
				gbc_textField.gridx = 0;
				gbc_textField.gridy = 0;
				pSpielfeld.repaint();
				MouseAdapter mouseListener = new MouseAdapter() {
					@Override
					public void mouseClicked(MouseEvent e) {
						FussballDialog.this.mouseClicked(e);
					}

					@Override
					public void mousePressed(MouseEvent e) {
						FussballDialog.this.mousePressed(e);
					}

					@Override
					public void mouseReleased(MouseEvent e) {
						FussballDialog.this.mouseReleased(e);
					}
				};
				pSpielfeld.addMouseListener(mouseListener);
			} catch (Exception e) {
				System.out.println("Image not found...");
			}
		}
		return pSpielfeld;
	}

	public Spieler getGewaehltenSpieler() {
		return gewaehlterSpieler;
	}

	public void setGewaehlterSpieler(Spieler gewaehlterSpieler) {
		this.gewaehlterSpieler = gewaehlterSpieler;
	}

	public void fuegeDraggerHinzu(Graphics g, int height, int width) {
		if (!isFormationErstellenModus()) {
			if (FussballDialog.this.getBounds().contains(
					new Rectangle2D.Float(MouseInfo.getPointerInfo()
							.getLocation().x - 25, MouseInfo.getPointerInfo()
							.getLocation().y - 25, 50, 50))) {
				((Graphics2D) g).drawImage(
						fuegeImageHinzu(getAusgewaehltesBild()),
						getPSpielfeld().getMousePosition().x - 25,
						getPSpielfeld().getMousePosition().y - 25, height,
						width, null);
			} else {
				if (getGewaehltenSpieler() != null) {
					getAusgewaehltePosition()
							.setSpieler(getGewaehltenSpieler());
					setGewaehlterSpieler(null);
				}
				setDrag(false);
			}
		} else {
			g.setColor(Color.RED);
			if (new Rectangle2D.Float(
					FussballDialog.this.getLocation().x + 112,
					FussballDialog.this.getLocation().y + 190, 580, 900)
					.contains(new Rectangle2D.Float(MouseInfo.getPointerInfo()
							.getLocation().x - 25, MouseInfo.getPointerInfo()
							.getLocation().y - 25, 50, 50))) {
				getAusgewaehltePosition().setShape(
						new Ellipse2D.Float(
								getPSpielfeld().getMousePosition().x - 25,
								getPSpielfeld().getMousePosition().y - 25,
								height, width));
			} else {
				getAusgewaehltePosition().setzeShapeAufSpielerpositionZurueck();
			}
		}
		this.repaint();
	}

	private void loeschePersonVonErsatzbank(MouseEvent e) {
		for (ShapeUndSpieler spielfeld : getSpielfeldPositionen()) {
			for (ShapeUndSpieler shapeUndPerson : getErsatzbankPositionen()) {
				if (shapeUndPerson.getSpieler() != null) {
					if (shapeUndPerson.getShape().contains(e.getPoint())) {
						shapeUndPerson.setSpieler(null);
						break;
					}
					if (spielfeld.getSpieler() != null) {
						if (spielfeld.getShape().contains(e.getPoint())) {
							spielfeld.setSpieler(null);
							break;
						}
					}
				}
			}
		}
	}

	private void zeigeVereinInformationen(MouseEvent e) {
		if (getAusgewaehltenVerein().getShape().contains(e.getPoint())) {
			SpielerDAO spielerDAO = new SpielerDAO();
			try {
				BufferedImage image = ImageIO.read(new File(
						getAusgewaehltenVerein().getVerein()
								.getVereinsWappenPfad()));
				getVereinInfoDialog().setVereinsWappen(image);
				getVereinInfoDialog().setImage(image);
				getVereinInfoDialog().repaint();

			} catch (IOException e1) {
			}
			setTextfelderTexte();
			List<Spieler> ausgabeListe = new ArrayList<>();
			for (Spieler spieler : spielerDAO.find(null,
					getAusgewaehltenVerein().getVerein().getId(), null, null,
					null, null)) {
				ausgabeListe.add(spieler);
			}
			getVereinInfoDialog().getTableModel().setSpieler(ausgabeListe);
		}
	}

	private void setTextfelderTexte() {
		getVereinInfoDialog().getTfName().setText(
				getAusgewaehltenVerein().getVerein().getVereinsname());
		getVereinInfoDialog().getTfManager().setText(
				getAusgewaehltenVerein().getVerein().getManager().getVorname()
						+ " "
						+ getAusgewaehltenVerein().getVerein().getManager()
								.getNachname());
		getVereinInfoDialog().getTfTrainer().setText(
				getAusgewaehltenVerein().getVerein().getTrainer().getVorname()
						+ " "
						+ getAusgewaehltenVerein().getVerein().getTrainer()
								.getNachname());
		getVereinInfoDialog().getTfMitglieder().setText(
				String.valueOf(getAusgewaehltenVerein().getVerein()
						.getAnzahlMitglieder()));
		getVereinInfoDialog().getTfMeisterschaften().setText(
				String.valueOf(getAusgewaehltenVerein().getVerein()
						.getAnzahlMeisterschaften()));
		getVereinInfoDialog().getTfFormation().setText(
				getAusgewaehltenVerein().getVerein().getFormation()
						.getBezeichnung());
	}

	private void zeigePersonInformationen(MouseEvent e) {
		for (ShapeUndSpieler ersatzbank : getErsatzbankPositionen()) {
			if (ersatzbank.getSpieler() != null) {
				if (ersatzbank.getShape().contains(e.getPoint())) {
					getErsatzbankDialog().getTfVorname().setText(
							ersatzbank.getSpieler().getVorname());
					getErsatzbankDialog().getTfNachname().setText(
							ersatzbank.getSpieler().getNachname());
					getErsatzbankDialog().getTfAlter().setText(
							ersatzbank.getSpieler().getAlter().toString());
					getErsatzbankDialog().getTfNationalitaet().setText(
							ersatzbank.getSpieler().getNationalitaet());
					getErsatzbankDialog().getTfID().setText(
							ersatzbank.getSpieler().getId().toString());
					getErsatzbankDialog().getLblImage().setIcon(
							new ImageIcon(fuegeImageHinzu(ersatzbank
									.getSpieler().getImagePath())));
					break;
				}
			}
		}

		for (ShapeUndSpieler spielfeld : getSpielfeldPositionen()) {
			if (spielfeld.getSpieler() != null) {
				if (spielfeld.getShape().contains(e.getPoint())) {
					getErsatzbankDialog().getTfVorname().setText(
							spielfeld.getSpieler().getVorname());
					getErsatzbankDialog().getTfNachname().setText(
							spielfeld.getSpieler().getNachname());
					getErsatzbankDialog().getTfAlter().setText(
							spielfeld.getSpieler().getAlter().toString());
					getErsatzbankDialog().getTfNationalitaet().setText(
							spielfeld.getSpieler().getNationalitaet());
					getErsatzbankDialog().getTfID().setText(
							spielfeld.getSpieler().getId().toString());
					getErsatzbankDialog().getLblImage().setIcon(
							new ImageIcon(fuegeImageHinzu(spielfeld
									.getSpieler().getImagePath())));
					break;
				}
			}
		}
	}

	public ErsatzbankInfoDialog getErsatzbankDialog() {
		if (ersatzbankDialog == null) {
			ersatzbankDialog = new ErsatzbankInfoDialog(FussballDialog.this);
			ersatzbankDialog.setLocation(
					FussballDialog.this.getLocation().x + 200,
					FussballDialog.this.getLocation().y + 200);
			ersatzbankDialog.setVisible(true);
			ersatzbankDialog.pack();
		}
		return ersatzbankDialog;
	}

	public VereinInfoDialog getVereinInfoDialog() {
		if (vereinInfoDialog == null) {
			vereinInfoDialog = new VereinInfoDialog(FussballDialog.this);
			vereinInfoDialog.setLocation(
					FussballDialog.this.getLocation().x + 200,
					FussballDialog.this.getLocation().y + 200);
			vereinInfoDialog.setVisible(true);
			vereinInfoDialog.pack();
		}
		return vereinInfoDialog;
	}

	public void setVereinInfoDialog(VereinInfoDialog dialog) {
		vereinInfoDialog = dialog;
	}

	public void setErsatzbankDialog(ErsatzbankInfoDialog dialog) {
		ersatzbankDialog = dialog;
	}

	private class Spielfeld extends JLabel {

		private static final long serialVersionUID = 1L;

		private Image image;

		public Spielfeld(Image image) {
			this.image = image;
		}

		public Image getImage() {
			return image;
		}

		@Override
		protected void paintComponent(Graphics g) {
			g.drawImage(getImage(), 0, 0, null);
			g.setColor(Color.gray);
			try {
				if (isDrag() == true) {
					fuegeDraggerHinzu(g, 50, 50);
				}
				// die gezeichneten Shape-Listen
				fuegeSpielerDemSpielfeldHinzu(g, getSpielfeldPositionen());
				fuegeSpielerDemSpielfeldHinzu(g, getErsatzbankPositionen());
				fuegeVereinDemSpielfeldHinzu(g);
			} catch (Exception e) {
			}
			super.paintComponent(g);
			System.out.println();
		}
	}

	public Rectangle getSpeicherShape() {
		return new Rectangle(100, 0, 150, 50);
	}

	public ShapeUndVerein getAusgewaehltenVerein() {
		return ausgewaehlterVerein;
	}

	public void setAusgewaehlterVerein(ShapeUndVerein ausgewaehlterVerein) {
		this.ausgewaehlterVerein = ausgewaehlterVerein;
	}

	public void fuegeVereinDemSpielfeldHinzu(Graphics g) {
		try {
			ImageReader reader = new ImageReader();
			((Graphics2D) g)
					.drawImage(
							reader.getImage(getAusgewaehltenVerein()
									.getVerein().getVereinsWappenPfad()),
							getAusgewaehltenVerein().getShape().getBounds().x,
							getAusgewaehltenVerein().getShape().getBounds().y,
							getAusgewaehltenVerein().getShape().getBounds().height,
							getAusgewaehltenVerein().getShape().getBounds().width,
							null);
		} catch (Exception e) {
			((Graphics2D) g).draw(getAusgewaehltenVerein().getShape());
		}
	}

	public List<ShapeUndSpieler> getSpielfeldPositionen() {
		if (spielfeldPositionen == null) {
			spielfeldPositionen = new ArrayList<>();
			for (Spielerposition spielerposition : getAusgewaehltenVerein()
					.getVerein().getFormation().getPositionen()) {
				spielfeldPositionen.add(new ShapeUndSpieler(spielerposition,
						null));
			}
		}
		return spielfeldPositionen;
	}

	public void fuegeSpielerDemSpielfeldHinzu(Graphics g,
			Collection<ShapeUndSpieler> liste) {
		for (ShapeUndSpieler shapeUndPerson : liste) {
			if (shapeUndPerson.getSpieler() == null) {
				if (getAusgewaehltePosition() != null
						&& getAusgewaehltePosition().equals(shapeUndPerson)
						&& isFormationErstellenModus()) {
					g.setColor(Color.RED);
				} else {
					g.setColor(Color.GRAY);
				}
				((Graphics2D) g).draw(shapeUndPerson.getShape());
			} else {
				((Graphics2D) g).drawImage(fuegeImageHinzu(shapeUndPerson
						.getSpieler().getImagePath()), shapeUndPerson
						.getShape().getBounds().x, shapeUndPerson.getShape()
						.getBounds().y,
						shapeUndPerson.getShape().getBounds().height,
						shapeUndPerson.getShape().getBounds().width, null);
			}
		}
	}

	public Rectangle erzeugeRectangle(int height) {
		return new Rectangle(720, height, 50, 50);
	}

	private JMenuBar getMyMenuBar() {
		if (menuBar == null) {
			menuBar = new JMenuBar();
			menuBar.add(getMnSpieler());
			menuBar.add(getMnVerein());
			menuBar.add(getMnFormation());
		}
		return menuBar;
	}

	private JMenu getMnSpieler() {
		if (mnSpieler == null) {
			mnSpieler = new JMenu("Spieler");
			mnSpieler.add(getMntmSpielerErstellen());
			mnSpieler.add(getMntmSpielerSuchen());
			mnSpieler.add(getMntmSpielerAusVerein());
		}
		return mnSpieler;
	}

	private JMenuItem getMntmSpielerErstellen() {
		if (mntmSpielerErstellen == null) {
			mntmSpielerErstellen = new JMenuItem("Neuen Spieler erstellen");
			mntmSpielerErstellen.addActionListener(new ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					SpielerErstellenDialog dialog = new SpielerErstellenDialog(
							FussballDialog.this, true);
					dialog.pack();
					dialog.setLocation(FussballDialog.this.getLocation().x,
							FussballDialog.this.getLocation().y);
					dialog.setVisible(true);
				}
			});
		}
		return mntmSpielerErstellen;
	}

	private JMenuItem getMntmSpielerSuchen() {
		if (mntmSpielerSuchen == null) {
			mntmSpielerSuchen = new JMenuItem("Spieler suchen");
			mntmSpielerSuchen.addActionListener(new ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					SpielerSuchenDialog dialog = new SpielerSuchenDialog(
							FussballDialog.this, true);
					dialog.pack();
					dialog.setLocation(FussballDialog.this.getLocation().x,
							FussballDialog.this.getLocation().y);
					dialog.setVisible(true);
				}
			});
		}
		return mntmSpielerSuchen;
	}

	public Image fuegeImageHinzu(String string) {
		try {
			bank = ImageIO.read(new File(string));
		} catch (IOException e) {
			System.out.println("Image not found!");
		}
		return bank;
	}

	private JMenu getMnVerein() {
		if (mnVerein == null) {
			mnVerein = new JMenu("Verein");
			mnVerein.add(getMntmVereinErstellen());
			mnVerein.add(getMntmVereinAuswaehlen());
		}
		return mnVerein;
	}

	private JMenuItem getMntmVereinErstellen() {
		if (mntmVereinErstellen == null) {
			mntmVereinErstellen = new JMenuItem("Verein erstellen");
			mntmVereinErstellen.addActionListener(new ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					VereinErstellenDialog dialog = new VereinErstellenDialog(
							FussballDialog.this);
					dialog.pack();
					dialog.setLocation(FussballDialog.this.getLocation().x,
							FussballDialog.this.getLocation().y);
					dialog.setVisible(true);
				}
			});
		}
		return mntmVereinErstellen;
	}

	private JMenuItem getMntmVereinAuswaehlen() {
		if (mntmVereinAuswaehlen == null) {
			mntmVereinAuswaehlen = new JMenuItem("Verein ausw\u00E4hlen");
			mntmVereinAuswaehlen.addActionListener(new ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					VereinAuswaehlenDialog dialog = new VereinAuswaehlenDialog(
							FussballDialog.this);
					dialog.setLocation(FussballDialog.this.getLocation().x,
							FussballDialog.this.getLocation().y);
					dialog.setVisible(true);
				}
			});
		}
		return mntmVereinAuswaehlen;
	}

	private JMenuItem getMntmSpielerAusVerein() {
		if (mntmSpielerAusVerein == null) {
			mntmSpielerAusVerein = new JMenuItem("Spieler aus Verein laden");
			mntmSpielerAusVerein.addActionListener(new ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					setzeVereinsspielerAufErsatzbank();
				}
			});
		}
		return mntmSpielerAusVerein;
	}

	public void setzeVereinsspielerAufErsatzbank() {
		SpielerDAO dao = new SpielerDAO();
		for (ShapeUndSpieler shapeUndSpieler : getErsatzbankPositionen()) {
			if (shapeUndSpieler.getSpieler() != null) {
				shapeUndSpieler.setSpieler(null);
			}
		}
		for (ShapeUndSpieler shapeUndSpieler : getSpielfeldPositionen()) {
			if (shapeUndSpieler.getSpieler() != null) {
				shapeUndSpieler.setSpieler(null);
			}
		}
		for (Spieler spieler : dao.find(null, getAusgewaehltenVerein()
				.getVerein().getId(), null, null, null, null)) {
			if (spieler.getImagePath() == null) {
				spieler.setImagePath("C:\\Users\\Jacobsen_Thies\\Pictures\\KeinSpielerAufDerBank.jpg");
			}
			for (ShapeUndSpieler shapeUndSpieler : getErsatzbankPositionen()) {
				if (shapeUndSpieler.getSpieler() == null) {
					shapeUndSpieler.setSpieler(spieler);
					getPSpielfeld().repaint();
					break;
				}
			}
		}
		System.out.println();
	}

	public boolean isFormationErstellenModus() {
		return formationErstellenModus;
	}

	public void setFormationErstellenModus(boolean formationErstellenModus) {
		this.formationErstellenModus = formationErstellenModus;
	}

	private JPanel getPButtons() {
		if (pButtons == null) {
			pButtons = new JPanel();
			pButtons.setBackground(Color.BLACK);
			GridBagLayout gbl_pButtons = new GridBagLayout();
			gbl_pButtons.columnWidths = new int[] { 0, 0, 35, 52, 28, 123 };
			gbl_pButtons.rowHeights = new int[] { 30, 23 };
			gbl_pButtons.columnWeights = new double[] { 0.0, 0.0, 0.0, 0.0,
					0.0, 0.0 };
			gbl_pButtons.rowWeights = new double[] { 0.0, 0.0 };
			pButtons.setLayout(gbl_pButtons);
			GridBagConstraints gbc_btnNeuStarten = new GridBagConstraints();
			gbc_btnNeuStarten.gridx = 0;
			gbc_btnNeuStarten.gridy = 1;
			pButtons.add(getBtnNeuStarten(), gbc_btnNeuStarten);
			GridBagConstraints gbc_btnAbbrechen = new GridBagConstraints();
			gbc_btnAbbrechen.anchor = GridBagConstraints.EAST;
			gbc_btnAbbrechen.insets = new Insets(0, 10, 0, 0);
			gbc_btnAbbrechen.gridx = 1;
			gbc_btnAbbrechen.gridy = 1;
			pButtons.add(getBtnAbbrechen(), gbc_btnAbbrechen);
			GridBagConstraints gbc_btnUebernehmen = new GridBagConstraints();
			gbc_btnUebernehmen.anchor = GridBagConstraints.EAST;
			gbc_btnUebernehmen.insets = new Insets(0, 5, 0, 0);
			gbc_btnUebernehmen.gridx = 2;
			gbc_btnUebernehmen.gridy = 1;
			pButtons.add(getBtnUebernehmen(), gbc_btnUebernehmen);
			GridBagConstraints gbc_lblFormation = new GridBagConstraints();
			gbc_lblFormation.fill = GridBagConstraints.VERTICAL;
			gbc_lblFormation.insets = new Insets(0, 5, 0, 0);
			gbc_lblFormation.anchor = GridBagConstraints.NORTHWEST;
			gbc_lblFormation.gridx = 3;
			gbc_lblFormation.gridy = 1;
			pButtons.add(getLblFormation(), gbc_lblFormation);
			GridBagConstraints gbc_cBFormationen = new GridBagConstraints();
			gbc_cBFormationen.fill = GridBagConstraints.VERTICAL;
			gbc_cBFormationen.insets = new Insets(0, 5, 0, 0);
			gbc_cBFormationen.anchor = GridBagConstraints.NORTHWEST;
			gbc_cBFormationen.gridx = 4;
			gbc_cBFormationen.gridy = 1;
			pButtons.add(getCBFormationen(), gbc_cBFormationen);
			GridBagConstraints gbc_btnFormationAendern = new GridBagConstraints();
			gbc_btnFormationAendern.fill = GridBagConstraints.VERTICAL;
			gbc_btnFormationAendern.insets = new Insets(0, 5, 0, 10);
			gbc_btnFormationAendern.anchor = GridBagConstraints.NORTHWEST;
			gbc_btnFormationAendern.gridx = 5;
			gbc_btnFormationAendern.gridy = 1;
			pButtons.add(getBtnFormationAendern(), gbc_btnFormationAendern);
		}
		return pButtons;
	}

	public JComboBox<Formation> getCBFormationen() {
		if (cBFormationen == null) {
			cBFormationen = new JComboBox<>();
			for (Formation formation : new FormationDAO()
					.findeAlleFormationen()) {
				cBFormationen.addItem(formation);
			}
			cBFormationen.setSelectedItem(getAusgewaehltenVerein().getVerein()
					.getFormation());
			cBFormationen.addActionListener(new ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					getAusgewaehltenVerein().getVerein().setFormation(
							(Formation) cBFormationen.getSelectedItem());
					setzeVereinsspielerAufErsatzbank();
					spielfeldPositionen = null;
					getAusgewaehltenVerein().getVerein().setFormation(
							(Formation) cBFormationen.getSelectedItem());
					new VereinDAO().save(getAusgewaehltenVerein().getVerein());
					getPSpielfeld().repaint();
				}
			});
		}
		return cBFormationen;
	}

	public JButton getBtnUebernehmen() {
		if (btnUebernehmen == null) {
			btnUebernehmen = new JButton("");
			btnUebernehmen.setToolTipText("Formation speichern");
			btnUebernehmen.setBackground(Color.BLACK);
			btnUebernehmen.setBorderPainted(false);
			btnUebernehmen.setEnabled(false);
			btnUebernehmen.setContentAreaFilled(false);
			btnUebernehmen.setToolTipText("Aenderungen uebernehmen");
			btnUebernehmen
					.setIcon(new ImageIcon(
							"C:\\Users\\Jacobsen_Thies\\Pictures\\360_ALLG_Speichern.gif"));
			btnUebernehmen.addActionListener(new ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					FormationSpeichernDialog eingabe = new FormationSpeichernDialog(
							FussballDialog.this);
					eingabe.setVisible(true);
					eingabe.setLocation(
							FussballDialog.this.getLocation().x + 100,
							FussballDialog.this.getLocation().y + 100);
				}
			});
		}
		return btnUebernehmen;
	}

	public JButton getBtnFormationAendern() {
		if (btnFormationAendern == null) {
			btnFormationAendern = new JButton("Formation \u00E4ndern");
			btnFormationAendern.addActionListener(new ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					setFormationErstellenModus(true);
					setzeVereinsspielerAufErsatzbank();
					getBtnFormationAendern().setEnabled(false);
					getBtnUebernehmen().setEnabled(true);
					getBtnAbbrechen().setEnabled(true);
				}
			});
		}
		return btnFormationAendern;
	}

	private JLabel getLblFormation() {
		if (lblFormation == null) {
			lblFormation = new JLabel("Formation:");
			lblFormation.setForeground(Color.WHITE);
		}
		return lblFormation;
	}

	private void mouseClicked(MouseEvent e) {
		if (!isFormationErstellenModus()) {
			if (e.getButton() == MouseEvent.BUTTON3) {
				loeschePersonVonErsatzbank(e);
				getPSpielfeld().repaint();
			} else if (e.getButton() == MouseEvent.BUTTON1) {
				if (e.getClickCount() == 2) {
					zeigePersonInformationen(e);
					zeigeVereinInformationen(e);
				}
			}
		}
	}

	private void mousePressed(MouseEvent e) {
		speicherDieUrsprungsposition(e);
	}

	private void mouseReleased(MouseEvent e) {
		if (!isFormationErstellenModus()) {
			setzeSpieler(e);
		} else {
			setzeSpielfeldposition(e);
		}
	}

	private void speicherDieUrsprungsposition(MouseEvent e) {
		if (!isFormationErstellenModus()) {
			if (e.getButton() == MouseEvent.BUTTON1) {
				if (e.getClickCount() == 1) {
					for (ShapeUndSpieler ersatzbank : getErsatzbankPositionen()) {
						if (ersatzbank.getSpieler() != null) {
							if (ersatzbank.getShape().contains(e.getPoint())) {
								setGewaehlterSpieler(ersatzbank.getSpieler());
								setAusgewaehltePosition(ersatzbank);
								setAusgewaehltesBild(ersatzbank.getSpieler()
										.getImagePath());
								ersatzbank.setSpieler(null);
								setDrag(true);
								getPSpielfeld().repaint();
								break;
							}
						}
					}
					for (ShapeUndSpieler spielfeld : getSpielfeldPositionen()) {
						if (spielfeld.getSpieler() != null) {
							if (spielfeld.getShape().contains(e.getPoint())) {
								setGewaehlterSpieler(spielfeld.getSpieler());
								setAusgewaehltePosition(spielfeld);
								setAusgewaehltesBild(spielfeld.getSpieler()
										.getImagePath());
								spielfeld.setSpieler(null);
								setDrag(true);
								getPSpielfeld().repaint();
								break;
							}
						}
					}
				}
			}
		} else {
			if (e.getButton() == MouseEvent.BUTTON1) {
				for (ShapeUndSpieler position : getSpielfeldPositionen()) {
					if (position.getShape().contains(e.getPoint())) {
						setAusgewaehltePosition(position);
						setDrag(true);
						getPSpielfeld().repaint();
						break;
					}
				}
			}
		}
	}

	private void setzeSpielfeldposition(MouseEvent e) {
		setDrag(false);
		if (getAusgewaehltePosition() != null) {
			for (ShapeUndSpieler shapeUndSpieler : getSpielfeldPositionen()) {
				if (!new Rectangle2D.Float(112, 100, 580, 900)
						.contains(new Rectangle2D.Float(e.getPoint().x - 25, e
								.getPoint().y - 25, 50, 50))
						|| (!shapeUndSpieler.equals(getAusgewaehltePosition()) && shapeUndSpieler
								.getShape().intersects(
										getAusgewaehltePosition().getShape()
												.getBounds().getX(),
										getAusgewaehltePosition().getShape()
												.getBounds().getY(),
										getAusgewaehltePosition().getShape()
												.getBounds().getHeight(),
										getAusgewaehltePosition().getShape()
												.getBounds().getWidth()))) {
					getAusgewaehltePosition()
							.setzeShapeAufSpielerpositionZurueck();
					break;
				}
			}
			setAusgewaehltePosition(null);
			getPSpielfeld().repaint();
		}
	}

	private void setzeSpieler(MouseEvent e) {
		setDrag(false);
		if (!befindetSichDieMausUeberEineGeeignetePosition(e)) {
			if (getAusgewaehltePosition() != null) {
				if (getGewaehltenSpieler() != null) {
					getAusgewaehltePosition()
							.setSpieler(getGewaehltenSpieler());
				}
			}
		}
		getPSpielfeld().repaint();
		setGewaehlterSpieler(null);
	}

	private boolean befindetSichDieMausUeberEineGeeignetePosition(MouseEvent e) {
		for (ShapeUndSpieler ersatzbankPosition : getErsatzbankPositionen()) {
			if (ersatzbankPosition.getShape().contains(e.getPoint())) {
				if (ersatzbankPosition.getSpieler() == null) {
					ersatzbankPosition.setSpieler(getGewaehltenSpieler());
					return true;
				}
			}
		}
		for (ShapeUndSpieler spielfeld : getSpielfeldPositionen()) {
			if (spielfeld.getShape().contains(e.getPoint())) {
				if (spielfeld.getSpieler() == null) {
					spielfeld.setSpieler(getGewaehltenSpieler());
					return true;
				}
			}
		}
		return false;
	}

	public ShapeUndSpieler getAusgewaehltePosition() {
		return ausgewaehltePosition;
	}

	public void setAusgewaehltePosition(ShapeUndSpieler ausgewaehltePosition) {
		this.ausgewaehltePosition = ausgewaehltePosition;
	}

	public JButton getBtnAbbrechen() {
		if (btnAbbrechen == null) {
			btnAbbrechen = new JButton("");
			btnAbbrechen.setBackground(Color.BLACK);
			btnAbbrechen.setBorderPainted(false);
			btnAbbrechen.setEnabled(false);
			btnAbbrechen.setContentAreaFilled(false);
			btnAbbrechen.setToolTipText("Abbrechen");
			btnAbbrechen
					.setIcon(new ImageIcon(
							"C:\\Users\\Jacobsen_Thies\\Pictures\\360_ALLG_Ungültig.gif"));
			btnAbbrechen.addActionListener(new ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					for (ShapeUndSpieler shapeUndSpieler : getSpielfeldPositionen()) {
						shapeUndSpieler.setzeShapeAufSpielerpositionZurueck();
					}
					setFormationErstellenModus(false);
					getBtnAbbrechen().setEnabled(false);
					getBtnFormationAendern().setEnabled(true);
					getBtnUebernehmen().setEnabled(false);
					getPSpielfeld().repaint();
				}
			});
		}
		return btnAbbrechen;
	}

	private JMenu getMnFormation() {
		if (mnFormation == null) {
			mnFormation = new JMenu("Formation");
			mnFormation.add(getMntmFormationSuchen());
		}
		return mnFormation;
	}

	private JMenuItem getMntmFormationSuchen() {
		if (mntmFormationSuchen == null) {
			mntmFormationSuchen = new JMenuItem("Formation suchen");
			mntmFormationSuchen.addActionListener(new ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					FormationSuchenDialog formationSuchenDialog = new FormationSuchenDialog(
							FussballDialog.this);
					formationSuchenDialog.setVisible(true);
					formationSuchenDialog.setLocation(FussballDialog.this
							.getLocation());
				}
			});
		}
		return mntmFormationSuchen;
	}

	public boolean isDrag() {
		return drag;
	}

	public void setDrag(boolean drag) {
		this.drag = drag;
	}

	public String getAusgewaehltesBild() {
		return ausgewaehltesBild;
	}

	public void setAusgewaehltesBild(String ausgewaehltesBild) {
		this.ausgewaehltesBild = ausgewaehltesBild;
	}

	private JButton getBtnNeuStarten() {
		if (btnNeuStarten == null) {
			btnNeuStarten = new JButton("Neu Starten");
			btnNeuStarten.addActionListener(new ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					try {
						try {
							restartApplication();
						} catch (URISyntaxException e1) {
							e1.printStackTrace();
						}
						// System.exit(0);
					} catch (IOException e1) {
						System.out.println("nein");
						e1.printStackTrace();
					}
					// .exe ausführen
					// try {
					// Runtime.getRuntime().exec("C:/Users/Jacobsen_Thies/eclipse/eclipse.exe");
					// System.exit(0);
					// } catch (IOException e1) {
					// e1.printStackTrace();
					// }
				}
			});
		}
		return btnNeuStarten;
	}

	public void restartApplication() throws URISyntaxException, IOException {
		final String javaBin = System.getProperty("java.home") + File.separator
				+ "bin" + File.separator + "java";
		final File currentJar = new File(Starter.class.getProtectionDomain()
				.getCodeSource().getLocation().toURI());

		/* is it a jar file? */
		if (!currentJar.getName().endsWith(".jar"))
			return;

		/* Build command: java -jar application.jar */
		final ArrayList<String> command = new ArrayList<String>();
		command.add(javaBin);
		command.add("-jar");
		command.add(currentJar.getPath());

		final ProcessBuilder builder = new ProcessBuilder(command);
		builder.start();
		System.exit(0);
	}
}